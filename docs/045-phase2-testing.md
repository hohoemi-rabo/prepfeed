# 045: Phase 2 統合テスト & 最終確認

## 概要

Phase 2 の全機能の統合テスト、ビルド確認、デプロイ前チェックを行う。

## 背景

大規模な機能追加（マルチプラットフォーム、認証、有料機能）が正しく連携動作することを確認する。

## テスト項目

### 無料機能（リアルタイム検索）

#### YouTube（Phase 1 からの継続動作確認）

- [ ] `/youtube/channel/[id]` でチャンネル分析が表示される
- [ ] `/youtube/keyword/[query]` でキーワード検索結果が表示される
- [ ] ソート（5種類）が正しく動作する
- [ ] チャートが表示される
- [ ] SNS共有が動作する

#### Qiita

- [ ] `/qiita/user/[id]` でユーザー記事一覧が表示される
- [ ] `/qiita/keyword/[query]` でキーワード検索結果が表示される
- [ ] ソート（いいね数/投稿日/ストック数）が動作する
- [ ] タグ表示・クリックが動作する

#### Zenn

- [ ] `/zenn/user/[username]` でユーザー記事一覧が表示される
- [ ] `/zenn/keyword/[query]` でトピック検索結果が表示される
- [ ] ソート（いいね数/投稿日）が動作する

#### ホームページ

- [ ] 3プラットフォームの検索UIが利用できる
- [ ] 各検索から結果ページに遷移する
- [ ] 旧URL（`/channel/[id]`, `/keyword/[query]`）がリダイレクトされる

### 認証機能

- [ ] Google ログインが成功する
- [ ] ログイン後にprofilesレコードが作成される
- [ ] ログイン状態がページ遷移後も維持される
- [ ] ログアウトが正しく動作する
- [ ] 未認証で `/dashboard` にアクセスするとリダイレクトされる

### 有料機能

#### 監視設定

- [ ] ステップウィザードで設定を追加できる
- [ ] 初回データ取得が実行される
- [ ] 初回データが collected_data に保存される
- [ ] 初回の簡易分析が analysis_results に保存される
- [ ] 設定の編集・削除ができる
- [ ] 無料ユーザーは設定追加できない

#### バッチ処理

- [ ] `/api/batch` でバッチ処理が実行される
- [ ] 認証なしではアクセスが拒否される
- [ ] 取得データが collected_data テーブルに保存される
- [ ] Upsert（差分更新）が正しく動作する
- [ ] 簡易分析が analysis_results に保存される
- [ ] fetch_logsに記録される

#### AI分析

- [ ] 簡易分析でトレンドスコア・サマリーが生成される
- [ ] 「詳細分析を実行」で202が返り、バックグラウンドジョブが起動する
- [ ] 詳細分析のプログレスがポーリングで取得できる
- [ ] 詳細分析完了後に結果が表示される
- [ ] 分析結果（トレンド、ネタ提案、競合分析）が正しい形式で返る
- [ ] Gemini APIエラー時にジョブが failed になる

#### ダッシュボード

- [ ] 簡易分析結果カードが監視設定ごとに表示される
- [ ] 詳細分析結果ページが正しく表示される
- [ ] 監視設定一覧が表示される
- [ ] 取得ログがインライン表示される

#### Google Sheetsエクスポート（オプション）

- [ ] Googleドライブ連携でOAuth画面が表示される
- [ ] 連携後にエクスポートボタンが有効になる
- [ ] 「Sheetsにエクスポート」でデータが書き出される
- [ ] CSVダウンロードが動作する
- [ ] 連携解除が正しく動作する

### 非機能テスト

- [ ] `npm run build` が成功する
- [ ] `npm run lint` でエラーがない
- [ ] レスポンシブ対応（モバイル/タブレット/デスクトップ）
- [ ] ダークモードで表示崩れがない
- [ ] API キャッシュが機能している
- [ ] レートリミットが適用されている

### セキュリティ

- [ ] RLSで他ユーザーのデータにアクセスできない
- [ ] 環境変数がクライアントに漏れていない
- [ ] Google トークンが暗号化されている
- [ ] CRON_SECRET が正しく検証されている

## 受け入れ条件

- [ ] 上記全テスト項目がPASS
- [ ] 本番デプロイ（Vercel）が成功する
- [ ] 本番環境で基本動作が確認できる

## 依存関係

- 026〜046 の全チケット完了後

## 参照

- phase2_v2-requirements.md（全体）
